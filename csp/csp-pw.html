<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.36">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/logo.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><title>4.4 CSP Practical Work | Angular Security Training</title><meta name="description" content="Learn how to prevent common threats in your Angular web application !">
    <link rel="modulepreload" href="/angular-security-training/assets/app.f04538c2.js"><link rel="modulepreload" href="/angular-security-training/assets/csp-pw.html.72d53780.js"><link rel="modulepreload" href="/angular-security-training/assets/csp-pw.html.dbec7291.js"><link rel="modulepreload" href="/angular-security-training/assets/pw-coding.b255a857.js"><link rel="modulepreload" href="/angular-security-training/assets/plugin-vue_export-helper.21dcd24c.js">
    <link rel="stylesheet" href="/angular-security-training/assets/style.5bcd0686.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header ref_key="navbar" class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/angular-security-training/" class=""><img class="logo" src="/angular-security-training/logo.svg" alt="Angular Security Training"><span class="site-name can-hide">Angular Security Training</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/angular-security-training/prerequisites/" class="sidebar-item sidebar-heading" aria-label="Prerequisites"><!--[--><!--]--> Prerequisites <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/introduction/" class="sidebar-item sidebar-heading" aria-label="1 Introduction"><!--[--><!--]--> 1 Introduction <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/" class="sidebar-item sidebar-heading" aria-label="2- Common Threats"><!--[--><!--]--> 2- Common Threats <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/common-threats/jwt/jwt-overview.html" class="sidebar-item" aria-label="1.1 JWT Overview"><!--[--><!--]--> 1.1 JWT Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/jwt/jwt-workflow.html" class="sidebar-item" aria-label="1.2 JWT Workflow"><!--[--><!--]--> 1.2 JWT Workflow <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/jwt/jwt-storage.html" class="sidebar-item" aria-label="1.3 JWT Storage"><!--[--><!--]--> 1.3 JWT Storage <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/jwt/jwt-known-threats.html" class="sidebar-item" aria-label="1.4 JWT Known Threats"><!--[--><!--]--> 1.4 JWT Known Threats <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/jwt/jwt-best-current-practices.html" class="sidebar-item" aria-label="1.5 JWT Best Current Practices"><!--[--><!--]--> 1.5 JWT Best Current Practices <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/jwt/jwt-pw.html" class="sidebar-item" aria-label="1.6 JWT Practical Work"><!--[--><!--]--> 1.6 JWT Practical Work <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/common-threats/csrf/csrf-overview.html" class="sidebar-item" aria-label="2.1 CSRF Overview"><!--[--><!--]--> 2.1 CSRF Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/csrf/csrf-detection.html" class="sidebar-item" aria-label="2.2 CSRF Detection"><!--[--><!--]--> 2.2 CSRF Detection <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/csrf/csrf-defense.html" class="sidebar-item" aria-label="2.3 CSRF Defense Best Practices"><!--[--><!--]--> 2.3 CSRF Defense Best Practices <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/csrf/csrf-angular.html" class="sidebar-item" aria-label="2.4 CSRF Protection in Angular"><!--[--><!--]--> 2.4 CSRF Protection in Angular <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/csrf/csrf-pw.html" class="sidebar-item" aria-label="2.5 CSRF Practical Work"><!--[--><!--]--> 2.5 CSRF Practical Work <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/common-threats/xss/xss-overview.html" class="sidebar-item" aria-label="3.1 XSS Overview"><!--[--><!--]--> 3.1 XSS Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/xss/xss-detection.html" class="sidebar-item" aria-label="3.2 XSS Detection"><!--[--><!--]--> 3.2 XSS Detection <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/xss/xss-defense.html" class="sidebar-item" aria-label="3.3 XSS Defense Best Practices"><!--[--><!--]--> 3.3 XSS Defense Best Practices <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/xss/xss-angular.html" class="sidebar-item" aria-label="3.4 XSS Protection in Angular"><!--[--><!--]--> 3.4 XSS Protection in Angular <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/xss/xss-pw.html" class="sidebar-item" aria-label="3.5 XSS Practical Work"><!--[--><!--]--> 3.5 XSS Practical Work <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/csp/csp-overview.html" class="sidebar-item" aria-label="4.1 CSP Overview"><!--[--><!--]--> 4.1 CSP Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/csp/csp-defense.html" class="sidebar-item" aria-label="4.2 CSP Defense"><!--[--><!--]--> 4.2 CSP Defense <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/csp/csp-angular.html" class="sidebar-item" aria-label="4.3 CSP in Angular"><!--[--><!--]--> 4.3 CSP in Angular <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/angular-security-training/csp/csp-pw.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="4.4 CSP Practical Work"><!--[--><!--]--> 4.4 CSP Practical Work <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/angular-security-training/csp/csp-pw.html#part-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="Part 1"><!--[--><!--]--> Part 1 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/angular-security-training/csp/csp-pw.html#part-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="Part 2"><!--[--><!--]--> Part 2 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/common-threats/ssti/ssti-overview.html" class="sidebar-item" aria-label="5.1 SSTI Overview"><!--[--><!--]--> 5.1 SSTI Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/ssti/ssti-angular.html" class="sidebar-item" aria-label="5.3 SSTI Protection in Angular"><!--[--><!--]--> 5.3 SSTI Protection in Angular <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/common-threats/sca/sca-overview.html" class="sidebar-item" aria-label="6.1 Vulnerable Components Overview"><!--[--><!--]--> 6.1 Vulnerable Components Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/sca/sca-detection.html" class="sidebar-item" aria-label="6.2 Vulnerable Components Detection"><!--[--><!--]--> 6.2 Vulnerable Components Detection <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/sca/sca-defense.html" class="sidebar-item" aria-label="6.3 Vulnerable Component Defense"><!--[--><!--]--> 6.3 Vulnerable Component Defense <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/sca/sca-angular.html" class="sidebar-item" aria-label="6.4 Vulnerable Components Protection in Angular"><!--[--><!--]--> 6.4 Vulnerable Components Protection in Angular <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/common-threats/sca/sca-pw.html" class="sidebar-item" aria-label="6.5 Vulnerable Components Practical Work"><!--[--><!--]--> 6.5 Vulnerable Components Practical Work <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/angular-security-training/advanced/" class="sidebar-item sidebar-heading" aria-label="3- Advanced Threats"><!--[--><!--]--> 3- Advanced Threats <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/advanced/api/api-overview.html" class="sidebar-item" aria-label="7.1 Unprotected APIs Overview"><!--[--><!--]--> 7.1 Unprotected APIs Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/advanced/api/api-defense.html" class="sidebar-item" aria-label="7.2 Unprotected API Defense"><!--[--><!--]--> 7.2 Unprotected API Defense <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/advanced/api/api-pw.html" class="sidebar-item" aria-label="7.3 Unprotected API Practical Work"><!--[--><!--]--> 7.3 Unprotected API Practical Work <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/angular-security-training/advanced/xssi/xssi-overview.html" class="sidebar-item" aria-label="8.1 XSSI Overview"><!--[--><!--]--> 8.1 XSSI Overview <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/advanced/xssi/xssi-defense.html" class="sidebar-item" aria-label="8.2 XSSI Defense"><!--[--><!--]--> 8.2 XSSI Defense <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/advanced/xssi/xssi-angular.html" class="sidebar-item" aria-label="8.3 XSSI protection in Angular"><!--[--><!--]--> 8.3 XSSI protection in Angular <!--[--><!--]--></a><!----></li><li><a href="/angular-security-training/advanced/xssi/xssi-pw.html" class="sidebar-item" aria-label="8.4 XSSI Practical Work"><!--[--><!--]--> 8.4 XSSI Practical Work <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a href="/angular-security-training/continuous-prevention/" class="sidebar-item sidebar-heading" aria-label="4. Global recommendations"><!--[--><!--]--> 4. Global recommendations <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="_4-4-csp-practical-work" tabindex="-1"><a class="header-anchor" href="#_4-4-csp-practical-work" aria-hidden="true">#</a> 4.4 CSP Practical Work</h1><h2 id="part-1" tabindex="-1"><a class="header-anchor" href="#part-1" aria-hidden="true">#</a> Part 1</h2><p><img src="/angular-security-training/assets/pw-coding.83642d8b.png" alt="pw"></p><p>Practical Work Web-Application directory : <strong>pw/pw-csp</strong></p><p>1 - Starter Content Security Policy</p><ul><li><p>Configure a minimalistic CSP in angular side (<code>index.html</code>) with the following value and observe the result (see console log) : <code>default-src &#39;none&#39;; script-src &#39;self&#39;; connect-src &#39;self&#39;; img-src &#39;self&#39;; style-src &#39;self&#39;;</code></p><ul><li>Hints : <ul><li>This policy allows images, scripts, AJAX, and CSS from the same origin, and does not allow any other resources to load (eg inline scripting, inline styles, object, frame, media, etc). It is a good starting point but often too restrictive for many existing sites</li><li>You can declare your CSP as a meta tag with <code>http-equiv</code> directive in <code>index.html</code> :<code>&lt;meta http-equiv=&quot;__directive__&quot; content=&quot;__value__&quot;&gt;</code></li></ul></li></ul></li><li><p>Update step by step the configuration in order to make the website load properly (Content-Security-Policy-Report-Only header)</p><ul><li>Hint : <span style="color:white;background-color:white;"> add unsafe-inline or unsafe-eval wherever needed to remove console alerts </span></li></ul></li><li><p>Check the security level of this CSP on <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener noreferrer">csp-evaluator.withgoogle.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>Declare the CSP server-side</p><ul><li>Hints : <ul><li>Use the spring security API HttpSecurity : <code>HttpSecurity#headers()#contentSecurityPolicy(&quot;...&quot;</code>)</li><li>Set the CSP configuration in <code>/server/src/main/java/com/worldline/bookstore/config/SecurityConfiguration.java</code></li><li>(if necessary) Bypass the angular-cli proxy in order to use the server-side CSP configuration (<code>ng build</code>, then use <code>http://localhost:8080/#/home</code>)</li></ul></li></ul></li></ul><p>2 - Configure a CSP 3</p><ul><li><p>Use CSP to secure your app against inline scripting</p><ul><li><p>In <code>index.html</code>, declare an arbitrary inline scripting : <code>&lt;script&gt;document.write(&#39;&lt;h1&gt;Inline scripting is &lt;b&gt;not recommended&lt;/b&gt;! But if you have not the choice, &lt;b&gt;secure your app with CSP&lt;/b&gt;&lt;/h1&gt;&#39;);&lt;/script&gt;&quot;</code></p></li><li><p>Update the CSP in order to block the inline scripting.</p></li><li><p>Update the CSP in order to allow this inline scripting securely (consider CSP3 SHA-256 hash syntax)</p></li><li><p>Hints : To generate the hash of the script content, use this online tool : <a href="https://report-uri.io/home/hash" target="_blank" rel="noopener noreferrer">report-uri.io/home/hash<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> (beware of spaces and carriage returns...)</p></li></ul></li><li><p>Check the security level of this CSP on <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noopener noreferrer">csp-evaluator.withgoogle.com/<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li></ul><h2 id="part-2" tabindex="-1"><a class="header-anchor" href="#part-2" aria-hidden="true">#</a> Part 2</h2><p>Practical Work Web-Application directory : <strong>pw/pw-csp-nonce</strong></p><p>The purpose of this PW is to implement a CSP based on a dynamic nonce. The CSP will be generated server-side but loaded client-side. Then we will add inline scripting and secure it with a nonce.</p><p>1 - Implement a CSP based on a nonce, server-side:</p><ul><li>Implement a CSPResource REST api endpoint to generate a random nonce and return a content-security-policy which declares this nonce in the <code>script-src</code> directive</li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>            <span class="token keyword">package</span> com<span class="token punctuation">.</span>worldline<span class="token punctuation">.</span>bookstore<span class="token punctuation">.</span>web<span class="token punctuation">.</span>rest<span class="token punctuation">;</span>

            <span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>MessageDigest<span class="token punctuation">;</span>
            <span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>NoSuchAlgorithmException<span class="token punctuation">;</span>
            <span class="token keyword">import</span> java<span class="token punctuation">.</span>security<span class="token punctuation">.</span>SecureRandom<span class="token punctuation">;</span>
            <span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Collections<span class="token punctuation">;</span>
            
            <span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span>
            
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Logger<span class="token punctuation">;</span>
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>LoggerFactory<span class="token punctuation">;</span>
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpStatus<span class="token punctuation">;</span>
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>ResponseEntity<span class="token punctuation">;</span>
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>Hex<span class="token punctuation">;</span>
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>GetMapping<span class="token punctuation">;</span>
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RequestMapping<span class="token punctuation">;</span>
            <span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>RestController<span class="token punctuation">;</span>
            
            <span class="token keyword">import</span> com<span class="token punctuation">.</span>codahale<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Timed<span class="token punctuation">;</span>
            
            <span class="token doc-comment comment">/**
             * REST controller for managing Content-Security-Policy confuguration with random nonce.
             */</span>
            <span class="token decorator"><span class="token at operator">@</span><span class="token function">RestController</span></span>
            <span class="token decorator"><span class="token at operator">@</span><span class="token function">RequestMapping</span></span><span class="token punctuation">(</span><span class="token string">&quot;/api&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CSPResource</span> <span class="token punctuation">{</span>
            
            	<span class="token keyword">private</span> final Logger log <span class="token operator">=</span> LoggerFactory<span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>CSPResource<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
            	
            	<span class="token doc-comment comment">/** Used for Script Nonce */</span>
            	<span class="token keyword">private</span> SecureRandom prng <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            
            	<span class="token decorator"><span class="token at operator">@</span><span class="token function">GetMapping</span></span><span class="token punctuation">(</span><span class="token string">&quot;/csp&quot;</span><span class="token punctuation">)</span>
                <span class="token decorator"><span class="token at operator">@</span><span class="token function">Timed</span></span>
                <span class="token comment">// Add Script Nonce CSP Policy</span>
                <span class="token keyword">public</span> ResponseEntity<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> <span class="token function">generateCSP</span><span class="token punctuation">(</span>HttpServletResponse response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              		<span class="token comment">// --Get its digest</span>
              		MessageDigest sha<span class="token punctuation">;</span>
              		<span class="token comment">// --Generate a random number</span>
              		String randomNum<span class="token punctuation">;</span>
              		<span class="token keyword">try</span> <span class="token punctuation">{</span>
              			<span class="token keyword">this</span><span class="token punctuation">.</span>prng <span class="token operator">=</span> SecureRandom<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;SHA1PRNG&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              			randomNum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prng<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              			sha <span class="token operator">=</span> MessageDigest<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">&quot;SHA-1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              		<span class="token punctuation">}</span>
              		<span class="token keyword">catch</span> <span class="token punctuation">(</span>NoSuchAlgorithmException e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              			<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResponseEntity<span class="token operator">&lt;</span><span class="token operator">&gt;</span></span><span class="token punctuation">(</span>Collections<span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">&quot;CSPException&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getLocalizedMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> HttpStatus<span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              		<span class="token punctuation">}</span>
              		
              		byte<span class="token punctuation">[</span><span class="token punctuation">]</span> digest <span class="token operator">=</span> sha<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>randomNum<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              		
              		<span class="token comment">// --Encode it into HEXA</span>
              		char<span class="token punctuation">[</span><span class="token punctuation">]</span> scriptNonce <span class="token operator">=</span> Hex<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>digest<span class="token punctuation">)</span><span class="token punctuation">;</span>
              
              		String csp <span class="token operator">=</span> <span class="token string">&quot;script-src&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;unsafe-eval&#39; &#39;strict-dynamic&#39; &quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;nonce-&quot;</span><span class="token operator">+</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>scriptNonce<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;&#39;&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=&#39;&quot;</span> <span class="token operator">+</span> <span class="token comment">// SRI hashes for https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js (work only for Chrome)</span>
              				<span class="token string">&quot;;&quot;</span> <span class="token operator">+</span>
              				<span class="token comment">// add connect-src directive to adapt CSP over cross-origin requests (CORS)  </span>
              				<span class="token string">&quot;connect-src&quot;</span><span class="token operator">+</span>
              				<span class="token string">&quot; http://localhost:8080 http://localhost:4200 ws://localhost:4200&quot;</span>
              				<span class="token operator">+</span> <span class="token string">&quot;;&quot;</span><span class="token operator">+</span>
              				<span class="token string">&quot; style-src&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span><span class="token operator">+</span>
              				<span class="token string">&quot;;&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; font-src&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;self&#39; &quot;</span><span class="token operator">+</span>
              				<span class="token string">&quot;;&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; img-src&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;self&#39; data:&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot;;&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; child-src&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;self&#39; &quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot;;&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; object-src&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; &#39;none&#39; &quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot;;&quot;</span> <span class="token operator">+</span>
              				<span class="token string">&quot; default-src&quot;</span> <span class="token operator">+</span>
              		    <span class="token string">&quot; &#39;self&#39; &quot;</span><span class="token punctuation">;</span>
              		
                      <span class="token constant">CSP</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">CSP</span></span><span class="token punctuation">(</span>csp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                      conf<span class="token punctuation">.</span><span class="token function">setNonce</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>scriptNonce<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      
                      log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>conf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      
                      <span class="token keyword">return</span> ResponseEntity<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token punctuation">}</span>
            
            <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>Note : Implement a CSP wrapper class (used by the CSPResource class) with 2 attributes :</p><ul><li><p><code>config</code> : stores the complete <code>Content-Security-Policy</code></p></li><li><p><code>nonce</code> : stores the nonce</p></li><li><p>Remove the csp configuration loaded from the <code>SecurityConfiguration.java</code> if any</p></li></ul><p>2 - Client-side implementation:</p><ul><li>Create a services/cspConfigService.ts file to GET the CSP config and nonce from the CSPResources REST api</li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>                <span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> Injector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span><span class="token punctuation">;</span>
                <span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient<span class="token punctuation">,</span> HttpResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/common/http&#39;</span><span class="token punctuation">;</span>
                
                <span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// Thuis service gets the Content-Security-Policy and a random nonce from a REST api endpoint /api/csp</span>
                <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">CspConfig</span> <span class="token punctuation">{</span>
                
                    <span class="token keyword">private</span> _config<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
                    <span class="token keyword">private</span> _nonce<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
                    <span class="token keyword">private</span> http<span class="token operator">:</span> HttpClient<span class="token punctuation">;</span>
                  
                    <span class="token comment">// can&#39;t use classical Angular DI for HttpClient here, because of &quot;cyclic dependency&quot; issues</span>
                    <span class="token comment">// Use Injector service to instanciate HttpClient </span>
                  	<span class="token function">constructor</span><span class="token punctuation">(</span>injector<span class="token operator">:</span>Injector<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    	<span class="token keyword">this</span><span class="token punctuation">.</span>http <span class="token operator">=</span> injector<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>HttpClient<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  	<span class="token punctuation">}</span>
                
                    <span class="token comment">// Load Content-Security-Policy from a REST api endpoint</span>
                    <span class="token comment">// The returned data will contain the CSP configuration (&#39;value&#39;) and the a random generated nonce (&#39;nonce&#39;)</span>
                    <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/api/csp&#39;</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">toPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                              <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                  <span class="token keyword">this</span><span class="token punctuation">.</span>_config <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                                  <span class="token keyword">this</span><span class="token punctuation">.</span>_nonce <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;nonce&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                                  <span class="token keyword">return</span> data<span class="token punctuation">;</span>
                               <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    
                    <span class="token keyword">get</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_config<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                
                    <span class="token keyword">get</span> <span class="token function">nonce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_nonce<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>Note : you will have to import and declare this new service in <code>app.module.ts</code></p><ul><li>Load the CSP with a meta tag and add an arbitrary <code>script</code> block with a nonce</li></ul><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code>        Update app<span class="token punctuation">.</span>component<span class="token punctuation">.</span>ts to add the following implementation
        
          <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">AppComponent</span> <span class="token punctuation">{</span>
          	
          	<span class="token keyword">private</span> csp<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
          	<span class="token keyword">private</span> nonce<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">;</span> 
          	
          	<span class="token function">constructor</span><span class="token punctuation">(</span>
          		<span class="token keyword">private</span> router<span class="token operator">:</span> Router<span class="token punctuation">,</span> 
          		<span class="token keyword">public</span> userService<span class="token operator">:</span> UserService<span class="token punctuation">,</span>
          		<span class="token keyword">public</span> cspConfig<span class="token operator">:</span> CspConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          
          	  	cspConfig<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
          	  		data <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          	  			
          	  			<span class="token keyword">this</span><span class="token punctuation">.</span>csp <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;value&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          	  			<span class="token keyword">this</span><span class="token punctuation">.</span>nonce <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">&#39;nonce&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
          	  			
          	  			<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&#39;csp : &#39;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>csp<span class="token punctuation">)</span><span class="token punctuation">;</span>
          	  			<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&#39;nonce : &#39;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>nonce<span class="token punctuation">)</span><span class="token punctuation">;</span>
          				
          				  <span class="token comment">// can&#39;t use the Meta#addTags() method to set CSP because it will insert the meta tag too late, so we add it &quot;manually&quot;</span>
          	  			<span class="token keyword">var</span> meta <span class="token operator">=</span> <span class="token string">&quot;&lt;meta http-equiv=\&quot;Content-Security-Policy\&quot; content=\&quot;&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>csp<span class="token operator">+</span><span class="token string">&quot;\&quot;&gt;&quot;</span><span class="token punctuation">;</span>
          	  			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderHtml</span><span class="token punctuation">(</span>meta<span class="token punctuation">,</span> <span class="token string">&#39;head&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          	  			<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;content-security-policy meta  : &#39;</span><span class="token operator">+</span>meta<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
                    <span class="token comment">// Add secure inline scripting (a script block with a nonce)</span>
          	  		  <span class="token comment">// The script will just render a message at the bottom of the page</span>
          				  <span class="token comment">// (here, we don&#39;t use document.write method otherwise it will replace the whole page rendering)</span>
          				  <span class="token keyword">var</span> yourHtmlString <span class="token operator">=</span> 
          					<span class="token string">&quot;&lt;script nonce=&#39;&quot;</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>nonce<span class="token operator">+</span><span class="token string">&quot;&#39;&gt;&quot;</span><span class="token operator">+</span>
          						<span class="token string">&quot;document.getElementsByTagName(&#39;body&#39;)[0].appendChild(&quot;</span><span class="token operator">+</span>
          							<span class="token string">&quot;document.createRange().createContextualFragment(&quot;</span><span class="token operator">+</span>
          								<span class="token string">&quot;&#39;&lt;h1&gt;Inline scripting is &lt;b&gt;not recommended&lt;/b&gt;! But if you have not the choice, &lt;b&gt;secure your app with CSP&lt;/b&gt;&lt;/h1&gt;&#39;));&lt;/script&gt;&quot;</span><span class="token punctuation">;</span>
          			 	  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">renderHtml</span><span class="token punctuation">(</span>yourHtmlString<span class="token punctuation">,</span> <span class="token string">&#39;head&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          				  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;inline scripting !!! &#39;</span><span class="token punctuation">,</span> yourHtmlString<span class="token punctuation">)</span><span class="token punctuation">;</span>				    
          	  	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          	<span class="token punctuation">}</span>
          
            <span class="token operator">...</span>
            
            <span class="token doc-comment comment">/**
          	 *	
          	 *	Renders an html portion inside a given html tag
          	 *	<span class="token keyword">@param</span> <span class="token parameter">message</span>: a string which represents the html portion to render in the page
          	 *	<span class="token keyword">@param</span> <span class="token parameter">parentTag</span> : the html tag name in which the html portion will be inserted as a first child
          	 */</span>
            <span class="token keyword">private</span> <span class="token function">renderHtml</span><span class="token punctuation">(</span>message<span class="token operator">:</span><span class="token builtin">string</span><span class="token punctuation">,</span> parentTag<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          		<span class="token keyword">var</span> fragment <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createContextualFragment</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
          		document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>parentTag<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragment<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><ul><li>Test your app from <code>http://localhost:4200</code> : the script should be executed without error message Check that your DOM contains the <code>Content-Security-Policy</code> meta tag with the nonce and that the inline scripting uses this nonce.</li></ul><p>Hint: Get <code>http://localhost:4200</code> and see the bottom of the &quot;home&quot; page. Normally a message is displayed. Check the browser&#39;s console. No error message. If you modify the nonce or remove it from <code>script</code> block (see <code>app.component.ts</code>), the script is not executed, and the message is no more displayed. An error appears in the console.</p><p>Note : <code>strict-dynamic</code> source expression specifies that the trust is explicitly given to a script present in the markup, by accompanying it with a nonce or a hash, shall be propagated to all the scripts loaded by that root script. At the same time, any whitelist or source expressions such as <code>self</code> or <code>unsafe-inline</code> will be ignored.</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: nourredine.k@gmail.com">Nourredine K.</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/angular-security-training/csp/csp-angular.html" class="" aria-label="4.3 CSP in Angular"><!--[--><!--]--> 4.3 CSP in Angular <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/angular-security-training/assets/app.f04538c2.js" defer></script>
  </body>
</html>
